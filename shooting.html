<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        body {
            background-repeat: no-repeat;
            background-position: right top;
            margin-right: 200px;
            background-attachment: fixed;
        }

        #color {
            background: #8583de;
            width: 400px;
            height: 400px;
            position: absolute;
        }

        #tank1 {
            background: #8583de;
            width: 40px;
            height: 40px;
            position: absolute;
            content: url(https://www.google.com/url?sa=i&rct=j&q=&esrc=s&source=images&cd=&ved=0ahUKEwjZpJPKgcXXAhWG2yYKHTiFCugQjBwIBA&url=https%3A%2F%2Fpng.pngtree.com%2Felement_pic%2F00%2F16%2F07%2F21579071db4cb72.jpg&psig=AOvVaw2ELxsXFA-7rXLoiuJtK2C7&ust=1510987580076341);
        }

        #tank2 {
            background: #A3C9de;
            width: 40px;
            height: 40px;
            position: absolute;
        }

        #background {
            background: #E00001;
            position: absolute;
            width: 460px;
            height: 460px;
            left: 0px;
            top: 0px;
            border-style: solid;
            border-color: black;
            border-width: 20px;
        }

        #bombTank1 {
            background: #F7FF00;
            width: 10px;
            height: 10px;
            position: absolute;
        }

        #bombTank2 {
            background: #0CA65B;
            width: 10px;
            height: 10px;
            position: absolute;
        }

        #obstacle1 {
            background: #8ECBA2;
            width: 80px;
            height: 40px;
            position: absolute;
        }

        #obstacle2 {
            background: #8ECBA2;
            width: 80px;
            height: 40px;
            position: absolute;
        }

        #obstacle3 {
            background: #8ECBA2;
            width: 80px;
            height: 40px;
            position: absolute;
        }

    </style>
    <meta charset="UTF-8">
    <title>BattleTank</title>
</head>

<body>
    <div>
        <h1>BATTLE TANK BY RICARDO PÉREZ</h1>
    </div>
    <div id="background"></div>
    <div id="tank1"></div>
    <div id="tank2"></div>
    <div id="bombTank1"></div>
    <div id="bombTank2"></div>
    <div id="obstacle1"></div>
    <div id="obstacle2"></div>
    <div id="obstacle3"></div>
    <a href="login.html"><button>Go To Login</button></a>
    <!--    <div id="tank"></div>-->
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
    //------------------------------------------------------------------------------------------------------//
    //VARIABLES GLOBALES.
    var lastLoopRun = 0;

    var controller = new Object();

    var xPositionTank2 = "Waiting";
    var yPositionTank2 = "Waiting";
    //CONTADOR DE VIDAS DEL TANK1 Y 2
    var countLivesTank1 = 3;
    var countLivesTank2 = 3;
    //CONTADOR DE PORCENTAJE DE VIDA DEL TANK1 Y 2
    var percentageLifeTank2 = 100;
    var percentageLifeTank1 = 100;
    //VAR DE CALIBRES MEDIO
    var percentage_life2_tank1 = 100;
    var percentage_life2_tank2 = 100;
    //VAR DE CALIBRES BAJO.
    var percentage_life3_tank1 = 100;
    var percentage_life3_tank2 = 100;
    var postValueTank2InX = "";
    var postValueTank2InY = "";

    var postValueTank1InX = "";
    var postValueTank1InY = "";

    var xPositionTank1 = "Waiting";
    var yPositionTank1 = "Waiting";

    var typeShotTank1 = "0";
    var directionShotTank1 = "";
    var directionShotTank2 = "";
    var isShootedTank1 = false;
    var isShootedTank2 = false;

    var moveLeft = true;
    var moveRight = true;
    //------------------------------------------------------------------------------------------------------//
    //CREAR OBJETOS
    function createObject(element, x, y, w, h) {
        var result = new Object();
        result.element = element;
        result.x = x;
        result.y = y;
        result.w = w;
        result.h = h;
        return result;
    }

    //------------------------------------------------------------------------------------------------------//
    //ASEGURAR BORDES CON LOS OBJETOS QUE SE PASEN COMO PARÁMETRO.

    function ensureBorders(object) {
        if (object.x <= 20) {
            object.x = 20;
        }
        if (object.y <= 20) {
            object.y = 20;
        }
        if (object.x + object.w > 480) {
            object.x = 480 - object.w;
        }
        if (object.y + object.h > 480) {
            object.y = 480 - object.h;
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //ASIGNAR POSICIONES EN EL DRAW.
    function setPosition(object) { //permitirá buscar posición del duende.
        var e = document.getElementById(object.element); //busca el elemento
        e.style.left = object.x + 'px'; //asigna las coordenadas donde estará el object
        e.style.top = object.y + 'px'; //asigna las coordenadas donde estará el object
    }
    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN DE MOSTRAR PARA ASIGNAR TODOS LOS OBJETOS.
    function showObjects() { //actualizar tank1
        setPosition(tank1);
        setPosition(bombTank1);
        setPosition(tank2);
        setPosition(bombTank2);
        setPosition(obstacle1);
        setPosition(obstacle2);
        setPosition(obstacle3);
    }
    //------------------------------------------------------------------------------------------------------//
    //POST Y GET DE LA POSICIÓN DEL TANK1 Y 2.
    function postPositionOfTanks() {
        //console.log("postT2X = " + postValueTank2InX + " t2,x = " + tank2.x + " pvT2Y = " + postValueTank2InY + " t2.y " + tank2.y);
        //console.log(lifeTank2);

        //PENDIENTE DE UN POSIBLE BUG SI NO PUEDES HACER EL POST CUANDO INTERSECTE LA VIDA.
        if (postValueTank2InX != tank2.x || postValueTank2InY != tank2.y || postValueTank2InX == tank2.x || postValueTank2InY == tank2.y || postValueTank1InX != tank1.x || postValueTank1InY != tank1.y || postValueTank1InX == tank1.x || postValueTank1InY == tank1.x) {
            $.ajax({
                type: "POST",
                url: "http://192.168.0.15:5000/api/v1/users/tank",
                contentType: 'application/json;charset=UTF-8',
                data: JSON.stringify({
                    tank1: {
                        x_t1: tank1.x,
                        y_t1: tank1.y
                    },
                    tank2: {
                        x_t2: tank2.x,
                        y_t2: tank2.y
                    }
                }, null, '\t'),
                dataType: "json",
                success: function(data) {
                    //   console.log("Posición del tank 2 actualizada");
                }
            });
            postValueTank2InX = tank2.x;
            postValueTank2InY = tank2.y;
            //console.log("PVT2x = " + postValueTank2InX + " PVT2y = " + postValueTank2InY);
        } else {
            console.log("No ha cambiado la posición el Tank2");
        }
    }

    function getPositionTank2() {
        $.get("http://192.168.0.15:5000/api/v1/users/tank", function(data, status) {
            xPositionTank2 = this;
            xPositionTank2 = data[data.length - 1]['tank2'].x;
            yPositionTank2 = this;
            yPositionTank2 = data[data.length - 1]['tank2'].y;
            //console.log("GET T2 X = " + xPositionTank2 + " Y = " + yPositionTank2);

            xPositionTank1 = this;
            xPositionTank1 = data[data.length - 2]['tank1'].x;
            yPositionTank1 = this;
            yPositionTank1 = data[data.length - 2]['tank1'].y;
            //console.log("GET T1 X = " + xPositionTank1 + " Y = " + yPositionTank1);
        });
    }
    //------------------------------------------------------------------------------------------------------//
    //POST Y GET DE LAS CANTIDADES DE VIDA DEl TANK1 DEL BATTLE TANK
    function postlivesOfTank1(lifeOfTank1, percentageTank1) {
        $.ajax({
            type: "POST",
            url: "http://192.168.0.15:5000/api/v1/users/tank/tank1/lives",
            contentType: 'application/json;charset=UTF-8',
            data: JSON.stringify({
                tank1: {
                    lives_t1: lifeOfTank1,
                    percentage_t1: percentageTank1
                }
            }, null, '\t'),
            dataType: "json",
            success: function(data) {
                console.log("Vidas actualizada DEL T1, gracias al Señor!");
            }
        });
        //console.log("PVT2x = " + percentageTank1 + " PVT2y = " + percentageTank2 + " LIVT1 " + lifeOfTank1 + " LIVT2 " + lifeOfTank2);
    }

    function getLivesOfTank1() {
        //console.log("Confio en el Señor");
        $.get("http://192.168.0.15:5000/api/v1/users/tank/tank1/lives", function(data, status) {
            percentageLifeTank1 = this;
            percentageLifeTank1 = data[data.length - 1]['tank1'].percentage_t1;
            countLivesTank1 = this;
            countLivesTank1 = data[data.length - 1]['tank1'].lives_t1;
        });
    }
    //------------------------------------------------------------------------------------------------------//
    //POST Y GET DE LAS CANTIDADES DE VIDA DEl TANK1 DEL BATTLE TANK
    function postlivesOfTank2(lifeOfTank2, percentageTank2) {
        $.ajax({
            type: "POST",
            url: "http://192.168.0.15:5000/api/v1/users/tank/tank2/lives",
            contentType: 'application/json;charset=UTF-8',
            data: JSON.stringify({
                tank2: {
                    lives_t2: lifeOfTank2,
                    percentage_t2: percentageTank2
                }
            }, null, '\t'),
            dataType: "json",
            success: function(data) {
                console.log("Vidas actualizada DEL T2, gracias al Señor!");
            }
        });
        //console.log("LIVT1 " + lifeOfTank1 + " LIVT2 " + lifeOfTank2);
    }

    function getLivesOfTank2() {
        //console.log("Confio en el Señor");
        $.get("http://192.168.0.15:5000/api/v1/users/tank/tank2/lives", function(data, status) {
            percentageLifeTank2 = this;
            percentageLifeTank2 = data[data.length - 1]['tank2'].percentage_t2;
            countLivesTank2 = this;
            countLivesTank2 = data[data.length - 1]['tank2'].lives_t2;
            console.log(" LIFET1 = " + percentageLifeTank1 + " COUNTLIVEST1 " + countLivesTank1 + " LIFET2 = " + percentageLifeTank2 + " COUNTLIVEST2 " + countLivesTank2);
        });
    }
    //------------------------------------------------------------------------------------------------------//
    //POST Y GET DE LOS LOG'S DEL BATTLE TANK
    function postLog(event) {
        //console.log("postT2X = " + postValueTank2InX + " t2,x = " + tank2.x + " pvT2Y = " + postValueTank2InY + " t2.y " + tank2.y);
        //console.log(lifeTank2);
        $.ajax({
            type: "POST",
            url: "http://192.168.0.15:5000/api/v1/users/tank/logs",
            contentType: 'application/json;charset=UTF-8',
            data: JSON.stringify({
                event: event
            }, null, '\t'),
            dataType: "json",
            success: function(data) {
                console.log("Log registrado");
            }
        });

    }

    function getLog() {
        $.get("http://192.168.0.15:5000/api/v1/users/tank/logs", function(data, status) {
            xPositionTank2 = this;
            logEvent = data[data.length - 1].event;
            console.log("LOG = " + logEvent);
        });
    }
    //------------------------------------------------------------------------------------------------------//
    //BRAIN DEL TANK1
    function brainMovesTank1() {
        if (xPositionTank2 != "Waiting" && yPositionTank2 != "Waiting") {
            //console.log("x POSITION TANK " + xPositionTank2 + " Y POSITION TANK = " + yPositionTank2);
            if (tank1.x > xPositionTank2 && tank1.y != yPositionTank2) {
                tank1.x -= tank1.x - xPositionTank2;
                showObjects();
                decideShot("findY", tank1, bombTank1, tank2, yPositionTank2, percentageLifeTank2);
            } else if (tank1.x < xPositionTank2 && tank1.y != yPositionTank2) {
                tank1.x += xPositionTank2 - tank1.x;
                showObjects();
                decideShot("findY", tank1, bombTank1, tank2, yPositionTank2, percentageLifeTank2);
            } else if (tank1.y > yPositionTank2 && tank1.x != xPositionTank2) {
                tank1.y -= tank1.y - yPositionTank2;
                showObjects();
                decideShot("findX", tank1, bombTank1, tank2, xPositionTank2, percentageLifeTank2);
            } else if (tank1.y < yPositionTank2 && tank1.x != xPositionTank2) {
                tank1.y += yPositionTank2 - tank1.y;
                showObjects();
                decideShot("findX", tank1, bombTank1, tank2, xPositionTank2, percentageLifeTank2);
            } else if (tank1.x == xPositionTank2 && tank1.y != yPositionTank2) {
                showObjects();
                decideShot("findY", tank1, bombTank1, tank2, yPositionTank2, percentageLifeTank2);
            } else {
                console.log("Estan en posiciones iguales");
            }
        }
    }

    function movementTank2() {
        if (xPositionTank1 != "Waiting" && yPositionTank1 != "Waiting") {
            //console.log("x POSITION TANK " + xPositionTank2 + " Y POSITION TANK = " + yPositionTank2);
            if (tank2.x > xPositionTank1 && tank2.y != yPositionTank1) {
                //console.log(" t2 mayor en x");
                //tank2.x -= tank2.x - xPositionTank1;
                showObjects();
                decideShot("findY", tank2, bombTank2, tank1, yPositionTank1, percentageLifeTank1);
            } else if (tank2.x < xPositionTank1 && tank2.y != yPositionTank1) {
                //console.log(" t2 menor en x");
                //tank2.x += xPositionTank1 - tank2.x;
                showObjects();
                decideShot("findY", tank2, bombTank2, tank1, yPositionTank1, percentageLifeTank1);
            } else if (tank2.y > yPositionTank1 && tank2.x != xPositionTank1) {
                tank2.y -= tank2.y - yPositionTank1;
                showObjects();
                decideShot("findX", tank2, bombTank2, tank1, xPositionTank1, percentageLifeTank1);
            } else if (tank2.y < yPositionTank1 && tank2.x != xPositionTank1) {
                tank2.y += yPositionTank1 - tank2.y;
                showObjects();
                decideShot("findX", tank2, bombTank2, tank1, xPositionTank1, percentageLifeTank1);
            } else if (tank2.x == xPositionTank1 && tank2.y != yPositionTank1) {
                showObjects();
                decideShot("findY", tank2, bombTank2, tank1, yPositionTank1, percentageLifeTank1);
            } else {
                console.log("Estan en posiciones iguales");
            }
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN DE DECIDIR DONDE SERÁ LA DIRECCIÓN DEL DISPARO
    function decideShot(angle, element, bombTank, destinyElement, positionTank, countLifeTank) {
        if (countLifeTank != 0) {
            //console.log("DECIDE SHOT TIENE COUNT LIFE TANK = " + countLifeTank);
            if (angle == "findY") {
                if (element.y < positionTank) {
                    //console.log("Buscando Y <");
                    if (element.element == "tank1") {
                        //console.log(" element " + element.element + " bomb " + bombTank.element);
                        shotTank1(element, bombTank, destinyElement, countLifeTank, "DOWN");
                    } else if (element.element == "tank2") {
                        //  console.log("SIIIIIIIIIIIII T2");
                        shotTank2(element, bombTank, destinyElement, countLifeTank, "DOWN");
                    }
                } else if (element.y > positionTank) {
                    if (element.element == "tank1") {
                        //    console.log("NOOOOOOOO");
                        shotTank1(element, bombTank, destinyElement, countLifeTank, "UP");
                    } else if (element.element == "tank2") {
                        //      console.log("SIIIIIIIIIIIII");
                        shotTank2(element, bombTank, destinyElement, countLifeTank, "UP");
                    }
                    //console.log("Buscando Y >");
                }
            } else if (angle == "findX") {
                //PENDIENTE, AQUÍ NO FUNCIONA HASTA AHORA.
                if (element.x < positionTank) {
                    shot(element, countLifeTank, "RIGHT");
                } else if (element.x > positionTank) {
                    shot(element, bombTank, destinyElement, countLifeTank, "LEFT");
                }
            }
        } else if (countLifeTank == 0) {
            //alert("¡TERMINÓ EL JUEGO!\nGANÓ = " + element.element + " PERDIÓ = " + destinyElement.element + " VIDA = " + countLifeTank);
            countLifeTank = "TERMINÓ";
            console.log(countLifeTank);
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //EJECUTAR DISPARO DEPENDIENDO DE LA CANTIDAD DE VIDA, Y LA DIRECCIÓN DEL DISPARO.
    function shotTank1(element, bombTank, destinyElement, countTank, moveShot) {
        if (countTank == 100) {
            //console.log("CONT TANK" + element.element + " " + countTank);
            if (moveShot == "DOWN") {
                //console.log("ELEMENT " + element.element);
                directionShotTank1 = "DOWN";
                initbombTank1();
                ensureObstacles1(bombTank, element);
                checkCollisionTank1(element, bombTank, destinyElement, countTank);
            } else if (moveShot == "UP") {
                //console.log("ELEMENT " + element.element);
                directionShotTank1 = "UP";
                initbombTank1();
                ensureObstacles1(bombTank, element);
                checkCollisionTank1(element, bombTank, destinyElement, countTank);
            }
        } else if (countTank == 50) {


        } else if (countTank < 50) {

        }
    }
    //------------------------------------------------------------------------------------------------------//
    //EJECUTAR DISPARO DEPENDIENDO DE LA CANTIDAD DE VIDA, Y LA DIRECCIÓN DEL DISPARO.
    function shotTank2(element, bombTank, destinyElement, countTank, moveShot) {
        if (countTank == 100) {
            //console.log("CONT TANK" + element.element + " " + countTank);
            if (moveShot == "DOWN") {
                //console.log("ELEMENT " + element.element + " BOMB " + bombTank.element + " DESTINY " + destinyElement.element);
                directionShotTank2 = "DOWN";
                initbombTank2();
                ensureObstacles2(bombTank, element);
                //console.log("DOWN O " + element.element + " BT " + bombTank.element + " D " + destinyElement.element);
                checkCollisionTank2(element, bombTank2, tank1, countTank);
            } else if (moveShot == "UP") {
                //console.log("ELEMENT " + element.element);
                directionShotTank2 = "UP";
                initbombTank2();
                ensureObstacles2(bombTank, element);
                //console.log("UP O " + element.element + " BT " + bombTank.element + " D " + destinyElement.element);
                checkCollisionTank2(element, bombTank, destinyElement, countTank);
            }
        } else if (countTank == 50) {


        } else if (countTank < 50) {

        }
    }
    //------------------------------------------------------------------------------------------------------//
    //INICIALIZAR LA POSICIÓN DEL DISPARO DEL TANK1
    function initbombTank1() {
        if (bombTank1.y <= 20) {
            //console.log("Entro y cargada");
            bombTank1.x = tank1.x + 20;
            bombTank1.y = tank1.y + bombTank1.h;
            isShootedTank1 = true;
        } else if (bombTank1.y > 440) {
            bombTank1.x = tank1.x + 20;
            bombTank1.y = tank1.y + bombTank1.h;
            isShootedTank1 = true;
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //INICIALIZAR LA POSICIÓN DEL DISPARO DEL TANK2
    function initbombTank2() {
        if (bombTank2.y <= 20) {
            //console.log("Entro y ");
            bombTank2.x = tank2.x + 20;
            bombTank2.y = tank2.y + bombTank2.h;
            isShootedTank2 = true;
        } else if (bombTank2.y > 460) {
            //console.log("Entro y cargada b2");
            bombTank2.x = tank2.x + 20;
            bombTank2.y = tank2.y + bombTank2.h;
            isShootedTank2 = true;
        } else {
            //console.log("no está entrando");
        }
    }
    //ASEGURAR OBSTACULOS DEL LADO DEL TANK1
    function ensureObstacles1(object, element) {
        if (object.y + object.h <= 190 && object.x + object.w >= 100 && object.x + object.w <= 180) {
            object.x = element.x + 20;
            object.y = element.y + element.h;
        } else if (object.y + object.h <= 190 && object.x + object.w >= 300 && object.x + object.w <= 380) {
            object.x = element.x + 20;
            object.y = element.y + element.h;
        } else if (object.y + object.h <= 290 && object.x + object.w >= 200 && object.x + object.w <= 280) {
            //console.log("si entro");
            object.x = element.x + 20;
            object.y = element.y + element.h;
        }

    }
    //ASEGURAR OBSTACULOS DEL LADO DEL TANK2
    function ensureObstacles2(object, element) {
        if (object.y + object.h >= 150 && object.x + object.w >= 100 && object.x + object.w <= 180) {
            //console.log("si entro");
            object.x = element.x + 20;
            object.y = element.y + element.h;
        } else if (object.y + object.h >= 150 && object.x + object.w >= 300 && object.x + object.w <= 380) {
            //console.log("si entro");
            object.x = element.x + 20;
            object.y = element.y + element.h;
        } else if (object.y + object.h >= 250 && object.x + object.w >= 200 && object.x + object.w <= 280) {
            //console.log("si entro");
            object.x = element.x + 20;
            object.y = element.y + element.h;
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN QUE PERMITE CHECKEAR SI COLISIONÓ EL OBJETO DE DESTINO. SI ES CIERTO DETIENE EL JUEGO.
    function checkCollisionTank1(element, bombTank, destinyElement, countTank) {
        //console.log("ChCt1 BOMB TANK" + bombTank.element + " DESTINY " + destinyElement.element);
        //TODO: DESCOMENTAR LOS LOG'S METHOD. //postLog("GANO = " + "[" + element.element + "]" + " PERDIO = [" + destinyElement.element + "]");
        if (intersects(bombTank, destinyElement)) {
            if (countLivesTank2 == 3) {
                console.log("COUNT LT2 = " + countLivesTank2);
                postlivesOfTank2(3, 100); //ACTUALIZARÁ EN EL BACK-END A VIDA 2 CON 100%
                getLivesOfTank2();
                console.log("DISPARO INTERSECTÓ A " + destinyElement.element);
                console.log("DISPARO = [" + element.element + "]\nRECIBIO EL DISPARO = [" + destinyElement.element + "]\nVIDAS TANK1 = [" + countLivesTank1 + "] TANK2 = [2]");
            } else if (countLivesTank2 == 2 && percentageLifeTank2 == 100) {
                postlivesOfTank2(2, 50); //ACTUALIZA A VIDA 2 CON 50 DE %.
                //modifica esto
                getLivesOfTank2();
                console.log("DISPARO INTERSECTÓ A " + destinyElement.element);
                console.log("DISPARO = [" + element.element + "]\nRECIBIO EL DISPARO = [" + destinyElement.element + "]\nVIDAS TANK1 = [" + countLivesTank1 + "]-[" + percentageLifeTank1 + "%] TANK2 = [2] - [50%]");
            }
        } else {
            //console.log("A.X [" + bombTank.x + "] < B.X [" + destinyElement.x + "] + B.W [" + destinyElement.w + "]" + " && A.X [" + bombTank.x + "] + A.W [" + bombTank.w + "] > B.X [" + destinyElement.x + "] && A.Y [" + bombTank.y + "] < B.Y [" + destinyElement.y + "]" + " + B.H " + destinyElement.h + "] &&  A.Y [" + bombTank.y + "] + A.H [" + bombTank.h + "] > B.Y [" + destinyElement.y + "]");
        }

    }
    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN QUE PERMITE CHECKEAR SI COLISIONÓ EL OBJETO DE DESTINO. SI ES CIERTO DETIENE EL JUEGO.
    function checkCollisionTank2(element, bombTank, destinyElement, countTank) {
        //TODO: AGREGAR VARIABLE DE TIPO DE DAÑO PARA BAJAR EN EL JSON Y SEGUIR EL JUEGO. VALIDAMOS SI EL ADVERSARIO TIENE 3 VIDAS ENTONCES LE QUITAREMOS EL 100% DE ESA VIDA. SI TIENE 2, LE QUITAREMOS EL 50% CON CALIBRE MEDIO. SI TIENE 1 LE QUITAREMOS 25%.
        //TODO: DESCOMENTAR LOS LOG'S METHOD. //postLog("GANO = " + "[" + element.element + "]" + " PERDIO = [" + destinyElement.element + "]");
        if (intersects(bombTank, destinyElement)) {
            if (countLivesTank1 == 3) {
                console.log("COUNT LT1 = " + countLivesTank1);
                postlivesOfTank1(3, 100);
                getLivesOfTank1();
                console.log("DISPARO INTERSECTÓ A " + destinyElement.element);
                console.log("DISPARO = [" + element.element + "]\nRECIBIO EL DISPARO = [" + destinyElement.element + "]\nVIDAS TANK1 = [" + countLivesTank1 + "] TANK2 = [2]");
            } else if (countLivesTank1 == 2 && percentageLifeTank1 == 100) {
                postlivesOfTank1(2, 50);
                getLivesOfTank1();
                console.log("DISPARO INTERSECTÓ A " + destinyElement.element);
                console.log("DISPARO = [" + element.element + "]\nRECIBIO EL DISPARO = [" + destinyElement.element + "]\nVIDAS TANK1 = [2]-[50%] TANK2 = [" + countLivesTank2 + "]-[" + percentageLifeTank2 + "%]");
            }
        } else {
            //console.log("A.X [" + bombTank.x + "] < B.X [" + destinyElement.x + "] + B.W [" + destinyElement.w + "]" + " && A.X [" + bombTank.x + "] + A.W [" + bombTank.w + "] > B.X [" + destinyElement.x + "] && A.Y [" + bombTank.y + "] < B.Y [" + destinyElement.y + "]" + " + B.H " + destinyElement.h + "] &&  A.Y [" + bombTank.y + "] + A.H [" + bombTank.h + "] > B.Y [" + destinyElement.y + "]");
        }
    }


    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN QUE PERMITE INTERSECTAR DOS OBJETOS MEDIANTE TRUE O FALSE EN SU POSICIÓN Y MEDIDA.
    function intersects(a, b) {
        return a.x <= b.x + b.w && a.x + a.w >= b.x && a.y <= b.y + b.h && a.y + a.h >= b.y;
    }

    //-----------------------------------------------------------------------------------------------x-------//
    //FUNCIÓN DE DECIDIR LA DIRECCIÓN DEL DISPARO CON VARIABLE GLOBAL DIRECCIÓN SHOT TANK1 Y LA VELOCIDAD DE DISPARO.
    function decideDirectionShotTank1() { //
        if (countLivesTank1 != 0) {
            if (directionShotTank1 == "UP") {
                //console.log("ESTA EN SHOOTING IT UP\tGRACAS MI SEÑOR!");
                bombTank1.y -= 32;
            } else if (directionShotTank1 == "DOWN") {
                //console.log("ESTA EN SHOOTING IT DOWN\tGRACAS MI SEÑOR!");
                bombTank1.y += 32;
            }
        }
    }
    //-----------------------------------------------------------------------------------------------x-------//
    //FUNCIÓN DE DECIDIR LA DIRECCIÓN DEL DISPARO CON VARIABLE GLOBAL DIRECCIÓN SHOT TANK2 Y LA VELOCIDAD DE DISPARO.
    function decideDirectionShotTank2() { //
        //   console.log(" count " + percentageLifeTank1);
        if (countLivesTank2 != 0) {
            //console.log(" count " + percentageLifeTank2 + " dst2 " + directionShotTank2);
            if (directionShotTank2 == "UP") {
                //console.log("ESTA EN SHOOTING IT UP\tGRACAS MI SEÑOR!");
                bombTank2.y -= 32;
            } else if (directionShotTank2 == "DOWN") {
                //console.log("ESTA EN SHOOTING IT DOWN\tGRACAS MI SEÑOR!");
                bombTank2.y += 32;
            }
        } else {
            console.log(" count " + percentageLifeTank1);
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN PRINCIPAL DEL JUEGO QUE SE REPETIRÁ DEPENDIENDO DEL TIEMPO EN SETTIMEOUT CON CADA UNO DE LOS
    //LLAMADOS A LAS DIFERENTES FUNCIONES.
    function loop() {
        if (new Date().getTime() - lastLoopRun > 40) { //CONDICIÓN PARA HACER EL CICLO
            //console.log(" b1 x" + bombTank1.x + " y = " + bombTank1.y);
            postPositionOfTanks(); //ENVIA LA POSICIÓN DEL TANK2 AL SERVER.
            getPositionTank2(); //RECIBE LA POSICIÓN DEL TANK2 AL SERVER.
            getLivesOfTank1();
            getLivesOfTank2();
            brainMovesTank1();
            ensureBorders(tank1);
            showObjects();
            decideDirectionShotTank1();
            decideDirectionShotTank2();
            brainMovesTank2();
            ensureBorders(tank2);
            showObjects();
            //checkCollisionTank2(tank2, bombTank2, tank1, percentageLifeTank1);
            lastLoopRun = new Date().getTime();
            //radar(tank2, bombTank1);
            //initbombTank2();
            //console.log(" b2 x" + bombTank2.x + " y = " + bombTank2.y);
        }
        setTimeout('loop();', 300);
    }
    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN DE PIVOT HACÍA EL RADAR QUE EN ESTE CASO HACE RADAR A DISPAROS PROVENIENTES DEL TANK1 o DISPARAR AL OPONENTE.
    function brainMovesTank2() {
        //DEFENDERSE
        //console.log(" IST1" + isShootedTank1);
        if (isShootedTank1 == true) {
            radar(tank2, bombTank1, isShootedTank1);
        }
        //OFENSIVA
        movementTank2();
    }

    //------------------------------------------------------------------------------------------------------//
    //FUNCIÓN DE RADAR (DEFENSIVA) PARA PODER MOVERSE Y PROTEGERSE PARA EVITAR EL DISPARO DEL OPONENTE.
    function radar(element, bomb, origin) {
        //console.log("ITS SHOOTED BY T1");
        //console.log("BOMBX " + (bomb.x) + " TANK2 = " + (element.x));
        if (bomb.x < element.x) {
            checkMovementRadar(element, origin);
        } else if (bomb.x > element.x) {
            checkMovementRadar(element, origin);
        } else if (bomb.x == element.x) {
            checkMovementRadar(element, origin);
        } else if (bomb.y == element.y) {
            if (element.y + element.h >= 20 && element.y + element.h < 440) {
                //MODIFICAR ESTOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
                element += 20;
                ensureBorders(element);
                showObjects();
            } else if (element.y + element.h <= 440 && element.y + element.h < 20) {
                element -= 20;
                ensureBorders(element);
                showObjects();
            }
        }
    }
    //------------------------------------------------------------------------------------------------------//
    //CHECKEA LOS MOVIMIENTOS QUE DEBE HACER EL TANK Y LA DIRECCIÓN QUE DEBE IR DEPENDIENDO EL DISPARO.
    function checkMovementRadar(element, type) {
        if (moveLeft) {
            element.x -= 5;
            showObjects();
        } else if (moveRight) {
            element.x += 5;
            showObjects();
        }
        if (element.x == 440) {
            element.x -= 5;
            //ensureBorders(element);
            showObjects();
            moveRight = false;
            moveLeft = true;
        } else if (element.x == 20) {
            element.x += 5;
            //ensureBorders(element);
            showObjects();
            moveLeft = false;
            moveRight = true;
        }
        //COLOCA LA Y
    }
    //------------------------------------------------------------------------------------------------------//
    //INICIALIZACIÓN DE LOS DIFERENTES OBJETOS QUE SE USARAN EN EL JUEGO.
    var tank1 = createObject('tank1', 250, 460, 40, 40);
    var tank2 = createObject('tank2', 25, 80, 40, 40);
    var bombTank1 = createObject('bombTank1', 0, -120, 5, 5);
    var bombTank2 = createObject('bombTank2', 0, -120, 5, 5);
    var obstacle1 = createObject('obstacle1', 100, 150, 80, 40);
    var obstacle2 = createObject('obstacle2', 300, 150, 80, 40);
    var obstacle3 = createObject('obstacle3', 200, 250, 80, 40);
    loop();

</script>

</html>
